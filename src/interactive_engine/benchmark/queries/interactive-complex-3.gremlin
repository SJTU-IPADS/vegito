g.timeout(600000).V().hasLabel('person').has('id',$personId).out('knows').union(identity(), out('knows')).dedup().filter(__.out('isLocatedIn').has('name',without('$countryXName','$countryYName'))).as('friend').filter(__.in('hasCreator').has('creationDate',inside($startDate,$endDate)).out('isLocatedIn').values('name').fold().filter(Lists.containsAll(Lists.of('$countryXName', '$countryYName')))).group().by().by(__.in('hasCreator').has('creationDate',inside($startDate,$endDate)).out('isLocatedIn').has('name', '$countryXName').count()).unfold().order().by(select(values), decr).by(select(keys).values('id')).limit(20)